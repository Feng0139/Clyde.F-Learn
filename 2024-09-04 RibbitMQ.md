# RabbitMQ 
RabbitMQ 是一个消息代理软件，用于在分布式系统中发送和接收消息。它实现了高级消息队列协议 (AMQP)，支持多种消息传递模式。以下是对 RabbitMQ 的详细总结：

## 核心概念

- **Producer（生产者）**：负责发送消息的应用程序或服务。生产者将消息发送到一个交换机（Exchange），而不是直接发送到队列。
    
- **Exchange（交换机）**：接受生产者发送的消息并根据绑定规则将消息路由到一个或多个队列。常见的交换机类型包括：
    
    - **Direct Exchange**：根据消息的路由键 (Routing Key) 进行精确匹配，将消息发送到绑定到该路由键的队列。
    - **Fanout Exchange**：将接收到的消息广播到所有绑定到该交换机的队列，无视路由键。
    - **Topic Exchange**：根据路由键的模式（如通配符）进行匹配，将消息发送到符合条件的队列。
    - **Headers Exchange**：基于消息头部 (Headers) 属性匹配，将消息发送到符合条件的队列。
- **Queue（队列）**：存储消息的缓冲区，消费者从队列中接收消息。队列是消息在 RabbitMQ 中的存储单元，消息在队列中保持直到被消费者消费或队列过期。
    
- **Consumer（消费者）**：从队列中接收并处理消息的应用程序或服务。消费者可以是长时间运行的进程，持续地从队列中获取消息。
    
- **Binding（绑定）**：将交换机和队列连接起来的关系，用于定义消息从交换机如何路由到队列。
    
- **Routing Key（路由键）**：消息的属性之一，用于将消息路由到特定的队列。路由键与交换机类型一起决定消息的路由规则。
    
- **vhost（虚拟主机）**：一个逻辑隔离的 RabbitMQ 实例。一个 RabbitMQ 服务器可以包含多个 vhost，每个 vhost 相当于一个独立的命名空间，用于隔离不同的应用或租户。
    

## 消息传递模式

- **发布/订阅 (Publish/Subscribe)**：生产者将消息发送到一个 `Fanout Exchange`，消息被广播到所有绑定的队列，多个消费者可以接收同一条消息的副本。
    
- **点对点 (Point-to-Point)**：生产者将消息发送到一个 `Direct Exchange`，通过路由键指定消息的目的队列，消息被发送到一个特定的消费者。
    
- **工作队列 (Work Queue)**：消息被轮询分发到多个消费者，这样可以平衡工作负载。例如，生产者将消息发送到队列中，多个消费者从同一个队列中获取消息，每个消息只会被一个消费者处理。
    
- **主题 (Topics)**：生产者将消息发送到 `Topic Exchange`，消费者可以通过绑定键的模式订阅特定的消息。例如，路由键可以使用 `logs.error` 或 `logs.*` 这样的模式。
    

## 消息确认与可靠性

- **消息确认 (Acknowledgments)**：当消费者成功处理一条消息后，发送一个确认 (ACK) 给 RabbitMQ，通知它可以安全地删除该消息。如果消费者处理消息时发生故障，消息可以被重新投递给其他消费者。
    
- **持久化 (Durability)**：为了防止 RabbitMQ 服务器崩溃导致消息丢失，可以将队列、交换机和消息标记为持久的，这样 RabbitMQ 会将它们保存到磁盘。
    
- **死信队列 (Dead Letter Queue, DLQ)**：如果消息由于无法路由、消费者拒绝消费等原因未能成功处理，RabbitMQ 可以将该消息发送到一个预定义的死信队列进行处理或记录。
    

## 高级特性

- **优先级队列 (Priority Queue)**：可以根据消息的优先级来处理消息，优先级高的消息会被优先消费。
    
- **延迟消息**：通过使用插件或死信交换机，可以实现消息的延迟投递。
    
- **集群 (Clustering)**：RabbitMQ 支持将多个节点组成集群，以实现高可用性和负载均衡。
    
- **镜像队列 (Mirrored Queue)**：在集群模式下，队列可以被镜像到多个节点，从而提高容错能力和数据可用性。
    

## 常见的使用场景

- **任务队列**：使用工作队列模式分配任务给多个工作进程，以实现负载均衡和异步处理。
- **消息广播**：使用发布/订阅模式将消息广播到多个订阅者，实现日志、通知等分发。
- **异步通信**：不同系统间的异步消息传递，解耦微服务，实现系统间的数据传输。

## 管理与监控

- **RabbitMQ 管理插件**：提供了一个基于 Web 的 UI，用于查看 RabbitMQ 的状态、管理交换机、队列、绑定等。
- **监控工具**：如 Prometheus、Grafana，可以与 RabbitMQ 集成，监控其性能指标（如队列长度、消息吞吐量等）。

## 部署服务

###  拉取 RabbitMQ 镜像

打开终端并运行以下命令，从 Docker Hub 拉取官方 RabbitMQ 镜像：

```
docker pull rabbitmq:3-management
```

这个镜像包含了 RabbitMQ 和管理插件（带有 Web UI）。

Tips：镜像名是 `rabbitmq:3-management` ，不是什么 `rabbitmq`、`rabbitmq:3` 之类的，这些都无法访问Web UI。

### 运行 RabbitMQ 容器

使用以下命令启动 RabbitMQ 容器：

```
docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management
```

- `-d`：后台运行容器。
- `--name rabbitmq`：给容器命名为 `rabbitmq`。
- `-p 5672:5672`：映射 RabbitMQ 的 AMQP 端口 5672。
- `-p 15672:15672`：映射管理 Web UI 的端口 15672。

### 访问管理界面

启动 RabbitMQ 后，可以通过浏览器访问管理界面：

- URL: `http://localhost:15672`
- 默认用户名：`guest`
- 默认密码：`guest`